---
const { folder = 'work' } = Astro.props

// Preload both collections; choose one based on the `folder` prop.
const collections = {
	work: import.meta.glob('/src/pages/work/*.astro'),
	projects: import.meta.glob('/src/pages/projects/*.astro'),
} as const

const selected = collections[folder] ?? {}

const itemPaths = Object.keys(selected).map((path) => `/${folder}/` + (path.match(new RegExp(`/${folder}/(.*)\\.astro$`))?.[1] ?? ''))

const itemModules = await Promise.all(Object.values(selected).map((loader) => loader()))

const items = itemModules
	.map((item, i) => ({
		...item.frontmatter,
		url: itemPaths[i],
		component: item.default,
	}))
	.sort((a, b) => b.order - a.order)
---

<div class="work-list-wrap">
	{
		items.map((item) => (
			<a href={item.url} class="work-item-wrap" style={`--page-color: ${item.color};`}>
				<div class="work-item-stack" />
				<div class="work-item-stack" />
				<div class="work-item-stack" />
				<div class="work-item-stack" />
				<div class="work-item">
					<div class="work-item-contents">
						{item.logo ? (
							<img class="work-item-logo" src={`/assets/logos/${item.logo}`} title={`${item.title} Logo`} />
						) : (
							<h3 class="work-item-title">{item.title}</h3>
						)}
					</div>
				</div>
			</a>
		))
	}
</div>
